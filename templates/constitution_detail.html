{% extends "base.html" %}
{% block content %}
<h2>{{ constitution.title }}</h2>
<p>{{ constitution.content }}</p>

<p>
  Status:
  {% if status == "passed" %}
    <span class="badge bg-success">Passed</span>
  {% elif status == "failed" %}
    <span class="badge bg-danger">Failed</span>
  {% else %}
    <span class="badge bg-warning">Not voted yet</span>
  {% endif %}
</p>

<p>
   Yes: {{ yes_seats }} <br>
   No: {{ no_seats }} <br>
   Abstain: {{ abstain_seats }} <br>
   Total seats: {{ total_seats }} <br>
   Majority needed: {{ majority_needed }}
</p>

<h4>Votes by Party</h4>
<ul>
  {% for v in votes %}
    {% set party = (calculate_riksdag_seats() | selectattr('id', 'equalto', v.party_id) | list).0 %}
    <li>{{ party.party if party else "Party " ~ v.party_id }} voted {{ v.vote_choice|capitalize }}</li>
  {% endfor %}
</ul>

{% if status == "not voted yet" %}
  <form method="POST">
    <button type="submit" name="vote" value="yes" class="btn btn-success">Yes</button>
    <button type="submit" name="vote" value="no" class="btn btn-danger">No</button>
    <button type="submit" name="vote" value="abstain" class="btn btn-secondary">Abstain</button>
  </form>
{% else %}
  <p>⚠️ Voting is closed for this constitution.</p>
{% endif %}

{% if g.user.username == ADMIN_USERNAME %}
  <form method="POST" action="{{ url_for('admin_delete_constitution', constitution_id=constitution.id) }}">
    <button type="submit" class="btn btn-danger mt-3">Delete Constitution</button>
  </form>
{% endif %}
{% endblock %}
